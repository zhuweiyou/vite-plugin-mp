{"version":3,"sources":["../src/index.ts"],"sourcesContent":["import { Plugin } from 'vite'\nimport * as glob from 'glob'\nimport { merge } from 'lodash'\nimport { resolve } from 'path'\n\nconst r = s => resolve(process.cwd(), s)\n\nexport function ViteMpPlugin(): Plugin {\n  return {\n    name: 'vite-plugin-mp',\n    config: c =>\n      merge(\n        {\n          root: 'src',\n          resolve: {\n            alias: {\n              '@': r('src'),\n            },\n          },\n          publicDir: r('public'),\n          build: {\n            emptyOutDir: true,\n            outDir: r('dist'),\n            rollupOptions: {\n              input: glob.sync('src/**/*.html').reduce(\n                (obj, file) => ({\n                  ...obj,\n                  [file\n                    .split('/')\n                    .slice(1)\n                    .join('.')\n                    .replace(/(\\.index)?\\.html$/, '')]: file,\n                }),\n                {}\n              ),\n              output: {\n                manualChunks: (id, { getModuleInfo }) => {\n                  if (\n                    [\n                      'commonjsHelpers.js',\n                      '\\x00commonjsHelpers.js',\n                      'vite/modulepreload-polyfill',\n                    ].includes(id)\n                  ) {\n                    return 'runtime'\n                  }\n\n                  if (\n                    id.includes('/node_modules/') &&\n                    getModuleInfo(id).importers.length > 1\n                  ) {\n                    return id.split('node_modules/')[1].split('/')[0]\n                  }\n                },\n              },\n            },\n          },\n        },\n        c\n      ),\n  }\n}\n"],"mappings":"o4BAAA,uDACA,MAAsB,mBACtB,EAAsB,kBACtB,EAAwB,gBAElB,EAAI,GAAK,cAAQ,QAAQ,IAAI,EAAG,CAAC,EAEhC,YAAgC,CACrC,MAAO,CACL,KAAM,iBACN,OAAQ,GACN,YACE,CACE,KAAM,MACN,QAAS,CACP,MAAO,CACL,IAAK,EAAE,KAAK,CACd,CACF,EACA,UAAW,EAAE,QAAQ,EACrB,MAAO,CACL,YAAa,GACb,OAAQ,EAAE,MAAM,EAChB,cAAe,CACb,MAAO,AAAK,OAAK,eAAe,EAAE,OAChC,CAAC,EAAK,IAAU,OACX,GADW,EAEb,EACE,MAAM,GAAG,EACT,MAAM,CAAC,EACP,KAAK,GAAG,EACR,QAAQ,oBAAqB,EAAE,GAAI,CACxC,GACA,CAAC,CACH,EACA,OAAQ,CACN,aAAc,CAAC,EAAI,CAAE,mBAAoB,CACvC,GACE,CACE,qBACA,uBACA,6BACF,EAAE,SAAS,CAAE,EAEb,MAAO,UAGT,GACE,EAAG,SAAS,gBAAgB,GAC5B,EAAc,CAAE,EAAE,UAAU,OAAS,EAErC,MAAO,GAAG,MAAM,eAAe,EAAE,GAAG,MAAM,GAAG,EAAE,EAEnD,CACF,CACF,CACF,CACF,EACA,CACF,CACJ,CACF","names":[]}