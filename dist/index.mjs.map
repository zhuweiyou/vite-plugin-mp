{"version":3,"sources":["../src/index.ts"],"sourcesContent":["import { Plugin } from 'vite'\nimport glob from 'glob'\nimport path from 'path'\nimport { merge } from 'lodash'\n\nconst resolve = filePath => path.resolve(process.cwd(), filePath)\n\nexport function ViteMpPlugin(): Plugin {\n  return {\n    name: 'vite-plugin-mp',\n    config: otherConfig =>\n      merge(\n        {\n          root: 'src',\n          resolve: {\n            alias: {\n              '@': resolve('src'),\n            },\n          },\n          publicDir: resolve('public'),\n          build: {\n            emptyOutDir: true,\n            outDir: resolve('dist'),\n            rollupOptions: {\n              input: glob.sync('src/**/*.html').reduce(\n                (obj, file) => ({\n                  ...obj,\n                  [file\n                    .split('/')\n                    .slice(1)\n                    .join('.')\n                    .replace(/(\\.index)?\\.html$/, '')]: file,\n                }),\n                {}\n              ),\n              output: {\n                manualChunks: (id, { getModuleInfo }) => {\n                  if (\n                    [\n                      'commonjsHelpers.js',\n                      '\\x00commonjsHelpers.js',\n                      'vite/modulepreload-polyfill',\n                    ].includes(id)\n                  ) {\n                    return 'runtime'\n                  }\n\n                  if (\n                    id.includes('/node_modules/') &&\n                    getModuleInfo(id).importers.length > 1\n                  ) {\n                    return id.split('node_modules/')[1].split('/')[0]\n                  }\n                },\n              },\n            },\n          },\n        },\n        otherConfig\n      ),\n  }\n}\n"],"mappings":"6aACA,oBACA,oBACA,+BAEA,GAAM,GAAU,GAAY,EAAK,QAAQ,QAAQ,IAAI,EAAG,CAAQ,EAEzD,YAAgC,CACrC,MAAO,CACL,KAAM,iBACN,OAAQ,GACN,EACE,CACE,KAAM,MACN,QAAS,CACP,MAAO,CACL,IAAK,EAAQ,KAAK,CACpB,CACF,EACA,UAAW,EAAQ,QAAQ,EAC3B,MAAO,CACL,YAAa,GACb,OAAQ,EAAQ,MAAM,EACtB,cAAe,CACb,MAAO,EAAK,KAAK,eAAe,EAAE,OAChC,CAAC,EAAK,IAAU,OACX,GADW,EAEb,EACE,MAAM,GAAG,EACT,MAAM,CAAC,EACP,KAAK,GAAG,EACR,QAAQ,oBAAqB,EAAE,GAAI,CACxC,GACA,CAAC,CACH,EACA,OAAQ,CACN,aAAc,CAAC,EAAI,CAAE,mBAAoB,CACvC,GACE,CACE,qBACA,uBACA,6BACF,EAAE,SAAS,CAAE,EAEb,MAAO,UAGT,GACE,EAAG,SAAS,gBAAgB,GAC5B,EAAc,CAAE,EAAE,UAAU,OAAS,EAErC,MAAO,GAAG,MAAM,eAAe,EAAE,GAAG,MAAM,GAAG,EAAE,EAEnD,CACF,CACF,CACF,CACF,EACA,CACF,CACJ,CACF","names":[]}